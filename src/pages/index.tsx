import Head from 'next/head'
import FormsTable from '@/components/FormsTable'
import { useEffect, useReducer } from 'react';
import PageWrapper from '@/components/PageWrapper';
import { getApplications } from '@/lib/apiHelpers';

type State = {
  status: 'idle' | 'loading' | 'success' | 'error';
  applicationStatusFilter: 'approved' | 'pending';
  data: any;
  isLoading: boolean;
  error: string | null;
};

type Action =
  | { type: 'FETCH_INIT' }
  | { type: 'FETCH_SUCCESS'; payload: any }
  | { type: 'FETCH_FAILURE'; payload: string }
  | { type: 'UPDATE_APPLICATION_STATUS'; payload: "approved" | "pending" };

const initialState: State = {
  applicationStatusFilter: 'approved',
  status: 'idle',
  data: null,
  isLoading: false,
  error: null,
};

const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'FETCH_INIT':
      return {
        ...state,
        isLoading: true,
        error: null,
      };
    case 'FETCH_SUCCESS':
      return {
        ...state,
        status: 'success',
        data: action.payload,
        isLoading: false,
        error: null,
      };
    case 'FETCH_FAILURE':
      return {
        ...state,
        status: 'error',
        isLoading: false,
        error: action.payload,
      };
    case 'UPDATE_APPLICATION_STATUS':
      return {
        ...state,
        applicationStatusFilter: action.payload,
      };
    default:
      // @ts-ignore
      throw new Error(`Unhandled action type: ${action.type}`);
  }
};


export default function Home() {
  const [state, dispatch] = useReducer(reducer, initialState);
  const { applicationStatusFilter, status, data, isLoading, error } = state;

  const fetchData = async (status: "pending" | "approved") => {
    dispatch({ type: 'FETCH_INIT' });
    try {
      const res = await getApplications(status);
      if (res.success) {
        dispatch({ type: 'FETCH_SUCCESS', payload: res.data.applications });
      } else {
        dispatch({ type: 'FETCH_FAILURE', payload: res.error });
      }
    } catch (error: any) {
      dispatch({ type: 'FETCH_FAILURE', payload: error.message });
    }
  };

  const updateApplicationStatusFilter = async (status: "pending" | "approved") => {
    dispatch({ type: 'UPDATE_APPLICATION_STATUS', payload: status });
    fetchData(status);
  }

  useEffect(() => {
    fetchData(applicationStatusFilter);
  }, [])

  return (
    <PageWrapper>
      <Head>
        <title>Home</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className='container mx-auto px-8 py-6 flex flex-col h-full'>
        <div className='shadow lg:mt-14 flex max-lg:flex-col lg:justify-between lg:items-center max-lg:gap-y-6 px-6 py-3 pb-8 lg:px-8 lg:py-5 bg-white/50 w-full'>
          <div className='flex items-center lg:justify-between gap-x-4 '>
            <div className='w-12 h-12 lg:h-16 lg:w-16 rounded-full bg-primary flex items-center justify-center'>
              <svg className='max-lg:hidden' width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.6108 17.6623C19.6108 19.4555 19.6386 21.2493 19.6004 23.0418C19.5778 24.1195 18.784 24.7962 17.6552 24.7975C14.4001 24.8009 11.1441 24.8009 7.8872 24.7975C6.97379 24.7975 6.06038 24.8014 5.14698 24.7975C3.94829 24.7917 3.19531 24.0367 3.19531 22.8432C3.19531 18.2223 3.19531 13.6016 3.19531 8.98104V8.63625C3.3331 8.62978 3.4463 8.61879 3.56016 8.61879C4.58095 8.61879 5.60174 8.61879 6.62253 8.61879C7.86197 8.61232 8.60848 7.86193 8.61042 6.62831C8.61042 5.50207 8.61042 4.37584 8.61042 3.22697C8.72621 3.21726 8.81872 3.20303 8.91058 3.20303C11.8358 3.19958 14.7587 3.19915 17.6792 3.20174C18.7562 3.20174 19.526 3.8842 19.6004 4.88365C19.6121 4.97805 19.5976 5.07385 19.5584 5.16052C19.1056 5.98854 18.6307 6.80297 18.1921 7.63746C16.6448 10.5821 15.1067 13.5317 13.5779 16.4863C13.4185 16.8002 13.3235 17.1429 13.2984 17.4941C13.2189 18.6624 13.1846 19.8339 13.1361 21.0035C13.1128 21.5702 13.3347 22.0172 13.8431 22.2779C14.338 22.5321 14.8219 22.4622 15.2663 22.1271C16.2502 21.3806 17.2386 20.6393 18.2116 19.8785C18.399 19.7185 18.5538 19.5239 18.6676 19.3054C18.9762 18.7568 19.2576 18.1927 19.5493 17.6345L19.6108 17.6623ZM10.0336 11.2988C8.88427 11.2988 7.73497 11.2988 6.58566 11.2988C6.10243 11.2988 5.89996 11.4282 5.90384 11.74C5.90772 12.0518 6.10761 12.1715 6.59666 12.1715H13.4601C13.5683 12.1751 13.6765 12.169 13.7836 12.1534C14.0171 12.1126 14.1478 11.9593 14.1459 11.7284C14.1439 11.4974 14.0003 11.3532 13.7732 11.3092C13.6774 11.297 13.5806 11.2935 13.4841 11.2988C12.3326 11.2984 11.1825 11.2984 10.0336 11.2988ZM9.03219 15.2947C9.88997 15.2947 10.7477 15.2947 11.6062 15.2947C11.9775 15.2947 12.1638 15.1504 12.1664 14.871C12.169 14.5915 11.9839 14.4401 11.612 14.4401C9.89601 14.4376 8.18003 14.4376 6.46404 14.4401C6.08949 14.4401 5.90448 14.587 5.90319 14.8658C5.9019 15.1446 6.08949 15.2947 6.45822 15.2953C7.316 15.2947 8.17377 15.2947 9.03219 15.2947ZM8.89247 20.7053C8.07674 20.7053 7.26166 20.7053 6.44593 20.7053C6.09338 20.7053 5.91354 20.8456 5.90319 21.1147C5.89284 21.3955 6.08238 21.5579 6.44464 21.5585C8.0541 21.5611 9.66356 21.5611 11.273 21.5585C11.6392 21.5585 11.8352 21.4039 11.8352 21.1316C11.8352 20.8592 11.6359 20.7053 11.2743 20.7046C10.4799 20.7007 9.6862 20.702 8.89247 20.702V20.7053ZM8.37043 18.4412C9.01732 18.4412 9.65968 18.4412 10.304 18.4412C10.6721 18.4412 10.8661 18.2891 10.8719 18.0136C10.8778 17.738 10.6843 17.5698 10.3221 17.5691C9.03349 17.5653 7.74445 17.5653 6.45499 17.5691C6.09273 17.5691 5.89866 17.7335 5.90384 18.0116C5.90901 18.2898 6.10437 18.4392 6.46922 18.4412C7.10317 18.4399 7.73518 18.4379 8.37043 18.4379V18.4412Z" fill="white" />
                <path d="M18.4314 9.03406L22.0663 10.934C20.7247 13.5034 19.3914 16.0554 18.0433 18.6365L14.4065 16.7379C15.7475 14.1717 17.0807 11.6184 18.4314 9.03406Z" fill="white" />
                <path d="M22.4715 10.159L18.823 8.252C19.2758 7.42204 19.664 6.58432 20.1634 5.81776C20.6983 4.99685 21.8453 4.78273 22.7257 5.23556C23.1535 5.45867 23.4888 5.82567 23.6725 6.27183C23.8561 6.718 23.8764 7.21469 23.7297 7.67433C23.6769 7.82637 23.612 7.97391 23.5356 8.11551C23.1921 8.78957 22.8363 9.46104 22.4715 10.159Z" fill="white" />
                <path d="M7.74148 3.61118C7.74148 4.66302 7.75895 5.76596 7.73372 6.86697C7.73174 7.09188 7.64331 7.30742 7.48675 7.46891C7.3302 7.63041 7.11751 7.72549 6.89277 7.73445C5.78012 7.75644 4.66682 7.74156 3.61304 7.74156L7.74148 3.61118Z" fill="white" />
                <path d="M14.1494 17.5711L17.5132 19.3274C16.8094 19.8643 16.1385 20.3773 15.4671 20.8903C15.22 21.0785 14.9845 21.2881 14.718 21.444C14.5886 21.519 14.3674 21.554 14.2477 21.4919C14.128 21.4298 14.0122 21.2221 14.0154 21.0817C14.042 19.9348 14.0982 18.7879 14.1494 17.5711Z" fill="white" />
              </svg>
              <svg className='lg:hidden' width="22" height="22" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.6108 17.6623C19.6108 19.4555 19.6386 21.2493 19.6004 23.0418C19.5778 24.1195 18.784 24.7962 17.6552 24.7975C14.4001 24.8009 11.1441 24.8009 7.8872 24.7975C6.97379 24.7975 6.06038 24.8014 5.14698 24.7975C3.94829 24.7917 3.19531 24.0367 3.19531 22.8432C3.19531 18.2223 3.19531 13.6016 3.19531 8.98104V8.63625C3.3331 8.62978 3.4463 8.61879 3.56016 8.61879C4.58095 8.61879 5.60174 8.61879 6.62253 8.61879C7.86197 8.61232 8.60848 7.86193 8.61042 6.62831C8.61042 5.50207 8.61042 4.37584 8.61042 3.22697C8.72621 3.21726 8.81872 3.20303 8.91058 3.20303C11.8358 3.19958 14.7587 3.19915 17.6792 3.20174C18.7562 3.20174 19.526 3.8842 19.6004 4.88365C19.6121 4.97805 19.5976 5.07385 19.5584 5.16052C19.1056 5.98854 18.6307 6.80297 18.1921 7.63746C16.6448 10.5821 15.1067 13.5317 13.5779 16.4863C13.4185 16.8002 13.3235 17.1429 13.2984 17.4941C13.2189 18.6624 13.1846 19.8339 13.1361 21.0035C13.1128 21.5702 13.3347 22.0172 13.8431 22.2779C14.338 22.5321 14.8219 22.4622 15.2663 22.1271C16.2502 21.3806 17.2386 20.6393 18.2116 19.8785C18.399 19.7185 18.5538 19.5239 18.6676 19.3054C18.9762 18.7568 19.2576 18.1927 19.5493 17.6345L19.6108 17.6623ZM10.0336 11.2988C8.88427 11.2988 7.73497 11.2988 6.58566 11.2988C6.10243 11.2988 5.89996 11.4282 5.90384 11.74C5.90772 12.0518 6.10761 12.1715 6.59666 12.1715H13.4601C13.5683 12.1751 13.6765 12.169 13.7836 12.1534C14.0171 12.1126 14.1478 11.9593 14.1459 11.7284C14.1439 11.4974 14.0003 11.3532 13.7732 11.3092C13.6774 11.297 13.5806 11.2935 13.4841 11.2988C12.3326 11.2984 11.1825 11.2984 10.0336 11.2988ZM9.03219 15.2947C9.88997 15.2947 10.7477 15.2947 11.6062 15.2947C11.9775 15.2947 12.1638 15.1504 12.1664 14.871C12.169 14.5915 11.9839 14.4401 11.612 14.4401C9.89601 14.4376 8.18003 14.4376 6.46404 14.4401C6.08949 14.4401 5.90448 14.587 5.90319 14.8658C5.9019 15.1446 6.08949 15.2947 6.45822 15.2953C7.316 15.2947 8.17377 15.2947 9.03219 15.2947ZM8.89247 20.7053C8.07674 20.7053 7.26166 20.7053 6.44593 20.7053C6.09338 20.7053 5.91354 20.8456 5.90319 21.1147C5.89284 21.3955 6.08238 21.5579 6.44464 21.5585C8.0541 21.5611 9.66356 21.5611 11.273 21.5585C11.6392 21.5585 11.8352 21.4039 11.8352 21.1316C11.8352 20.8592 11.6359 20.7053 11.2743 20.7046C10.4799 20.7007 9.6862 20.702 8.89247 20.702V20.7053ZM8.37043 18.4412C9.01732 18.4412 9.65968 18.4412 10.304 18.4412C10.6721 18.4412 10.8661 18.2891 10.8719 18.0136C10.8778 17.738 10.6843 17.5698 10.3221 17.5691C9.03349 17.5653 7.74445 17.5653 6.45499 17.5691C6.09273 17.5691 5.89866 17.7335 5.90384 18.0116C5.90901 18.2898 6.10437 18.4392 6.46922 18.4412C7.10317 18.4399 7.73518 18.4379 8.37043 18.4379V18.4412Z" fill="white" />
                <path d="M18.4314 9.03406L22.0663 10.934C20.7247 13.5034 19.3914 16.0554 18.0433 18.6365L14.4065 16.7379C15.7475 14.1717 17.0807 11.6184 18.4314 9.03406Z" fill="white" />
                <path d="M22.4715 10.159L18.823 8.252C19.2758 7.42204 19.664 6.58432 20.1634 5.81776C20.6983 4.99685 21.8453 4.78273 22.7257 5.23556C23.1535 5.45867 23.4888 5.82567 23.6725 6.27183C23.8561 6.718 23.8764 7.21469 23.7297 7.67433C23.6769 7.82637 23.612 7.97391 23.5356 8.11551C23.1921 8.78957 22.8363 9.46104 22.4715 10.159Z" fill="white" />
                <path d="M7.74148 3.61118C7.74148 4.66302 7.75895 5.76596 7.73372 6.86697C7.73174 7.09188 7.64331 7.30742 7.48675 7.46891C7.3302 7.63041 7.11751 7.72549 6.89277 7.73445C5.78012 7.75644 4.66682 7.74156 3.61304 7.74156L7.74148 3.61118Z" fill="white" />
                <path d="M14.1494 17.5711L17.5132 19.3274C16.8094 19.8643 16.1385 20.3773 15.4671 20.8903C15.22 21.0785 14.9845 21.2881 14.718 21.444C14.5886 21.519 14.3674 21.554 14.2477 21.4919C14.128 21.4298 14.0122 21.2221 14.0154 21.0817C14.042 19.9348 14.0982 18.7879 14.1494 17.5711Z" fill="white" />
              </svg>
            </div>
            <div className='flex flex-col  flex-1'>
              <h1 className='text-primary text-lg font-semibold'>Forms</h1>
              <h2 className='text-primary/50 leading-5 font-medium text-sm'>All the compulsory forms are available here</h2>
            </div>
          </div>
          <div className='flex gap-x-4'>
            <div className='relative flex items-center max-lg:w-full'>
              <input type="text" className='w-full lg:w-[300px] py-3 px-5 text-primary placeholder:text-primary border border-grey/[35%] focus:outline-primary' placeholder='Search' />
              <svg className='absolute right-5' width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0_1_190)">
                  <path d="M7.00508 0H7.9697C8.01693 0.0127057 8.06493 0.0223717 8.1134 0.0289387C8.93067 0.0931361 9.72199 0.275417 10.4624 0.623347C13.1464 1.88434 14.6642 3.98789 14.9443 6.94895C15.0727 8.30674 14.8019 9.60433 14.1792 10.8158C13.9181 11.3244 13.5871 11.7967 13.2695 12.3153C13.3117 12.3449 13.3519 12.3775 13.3896 12.4127C14.4739 13.4951 15.5564 14.579 16.637 15.6645C16.7804 15.8095 16.8795 15.9988 16.9989 16.1674V16.4668C16.987 16.4769 16.9766 16.4888 16.9683 16.5021C16.7435 17.0512 16.1936 17.1673 15.7709 16.7479C14.7951 15.7755 13.8211 14.8014 12.8487 13.8257C12.6578 13.6335 12.4698 13.4382 12.2739 13.2386L12.1199 13.356C10.3437 14.7182 8.35123 15.2307 6.1449 14.8422C2.73778 14.2428 0.166228 11.3041 0.00822914 7.84505C-0.0582967 6.34822 0.277326 4.9432 1.059 3.66258C2.22853 1.7483 3.91795 0.565469 6.12295 0.130723C6.41433 0.0731784 6.71104 0.0429091 7.00508 0ZM13.5848 7.48016C13.5752 4.11096 10.824 1.36544 7.47641 1.38606C4.10289 1.40669 1.3933 4.11861 1.38631 7.48182C1.37899 10.8377 4.12451 13.5856 7.48673 13.5846C10.8489 13.5836 13.5941 10.8344 13.5848 7.48016Z" fill="#004A91" />
                </g>
                <defs>
                  <clipPath id="clip0_1_190">
                    <rect width="16.998" height="17" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </div>
            <div className='relative flex items-center w-[180px] max-lg:hidden'>
              <select className='pr-8 w-full appearance-none py-3 px-5 text-primary placeholder:text-primary border border-grey/[35%] focus:outline-primary'>
                <option value="Sort by">Sort by</option>
              </select>

              <svg className='absolute right-6' width="12" height="6" viewBox="0 0 12 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1.90942 0.443042L1.9092 0.443341L1.96694 0.485214L1.97561 0.491496L1.97536 0.491788L6.32 4.14109L10.6646 0.491791L1.90942 0.443042ZM1.90942 0.443042L1.90048 0.437474M1.90942 0.443042L1.90048 0.437474M1.90048 0.437474C1.64642 0.279128 1.28914 0.294536 1.05431 0.491791C0.922203 0.602764 0.85 0.75448 0.85 0.912445C0.85 1.07041 0.922203 1.22213 1.05431 1.3331L5.85948 5.36943L5.85923 5.36973L5.8679 5.37601L5.92564 5.41788L5.92542 5.41818L5.93436 5.42375C6.18842 5.5821 6.5457 5.56669 6.78052 5.36943L11.5857 1.3331L11.5859 1.33341L11.5938 1.32575L11.6437 1.27725L11.644 1.27755L11.6515 1.26904C11.8584 1.0348 11.8312 0.698024 11.5857 0.491791L11.5859 0.491499L11.5773 0.485214L11.5195 0.443341L11.5197 0.443043M1.90048 0.437474L11.5197 0.443043M11.5197 0.443043L11.5108 0.437474M11.5197 0.443043L11.5108 0.437474M11.5108 0.437474C11.2567 0.279129 10.8995 0.294536 10.6646 0.491788L11.5108 0.437474Z" fill="#004A91" stroke="#004A91" stroke-width="0.3" />
              </svg>

            </div>
          </div>
        </div>
        <FormsTable data={data} status={status} statusFilter={applicationStatusFilter} changeStatus={updateApplicationStatusFilter} />
      </div>
    </PageWrapper>
  )
}
